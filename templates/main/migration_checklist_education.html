{% extends 'base.html' %}

{% block title %}Pradesh Setu - Migration Checklist{% endblock %}

{% block extra_head %}
<style>
    .progress-gradient {
        background: linear-gradient(90deg, #7CB342 0%, #AED581 100%);
    }
</style>
{% endblock %}

{% block header %}
<header class="px-6 py-4 flex items-center justify-between">
    <button onclick="history.back()" class="w-10 h-10 rounded-full bg-white dark:bg-zinc-800 flex items-center justify-center ios-shadow">
        <span class="material-icons-round text-slate-700 dark:text-slate-300">chevron_left</span>
    </button>
    <h1 class="text-xl font-bold tracking-tight">Pre-Departure Guide</h1>
    <button class="w-10 h-10 rounded-full bg-white dark:bg-zinc-800 flex items-center justify-center ios-shadow text-primary">
        <span class="material-icons-round">volume_up</span>
    </button>
</header>
{% endblock %}

{% block content %}
<!-- Progress Card -->
<div class="bg-white/50 dark:bg-zinc-900/50 p-5 rounded-3xl border border-white dark:border-zinc-800 ios-shadow">
    <div class="flex justify-between items-end mb-3">
        <div>
            <p class="text-xs font-medium text-slate-500 dark:text-slate-400 uppercase tracking-wider">Your Progress</p>
            <h2 class="text-lg font-bold">{{ completed_count }} of {{ total_count }} Steps Completed</h2>
        </div>
        <span class="text-primary font-bold text-xl">{{ progress_pct }}%</span>
    </div>
    <div class="w-full bg-slate-200 dark:bg-zinc-700 h-2.5 rounded-full overflow-hidden">
        <div class="progress-gradient h-full rounded-full" style="width: {{ progress_pct }}%"></div>
    </div>
</div>

<!-- Audio Guide -->
<div class="mt-4 bg-primary/10 dark:bg-primary/20 p-4 rounded-2xl flex items-center gap-4">
    <div class="bg-primary text-white w-10 h-10 rounded-full flex items-center justify-center">
        <span class="material-icons-round">play_arrow</span>
    </div>
    <div class="flex-1">
        <p class="text-sm font-semibold">Listen to Audio Guidance</p>
        <p class="text-xs text-slate-500 dark:text-slate-400">Available in Nepali &amp; English</p>
    </div>
</div>

<!-- Checklist Items -->
<div class="mt-6 space-y-4 mb-6">
    <h3 class="text-sm font-bold text-slate-400 uppercase tracking-widest px-1">Mandatory Steps</h3>

    {% for p in progress_items %}
    {% if p.is_completed %}
    <!-- Completed Item -->
    <form method="post" class="block">
        {% csrf_token %}
        <input type="hidden" name="item_id" value="{{ p.item.pk }}" />
        <button type="submit" class="w-full bg-white dark:bg-zinc-900 p-5 rounded-[28px] ios-shadow flex items-center gap-4 border border-transparent dark:border-zinc-800 text-left">
            <div class="w-14 h-14 rounded-2xl bg-primary/10 dark:bg-primary/20 flex items-center justify-center text-primary">
                <span class="material-icons-round text-3xl">{% if p.item.category == 'document' %}description{% elif p.item.category == 'training' %}school{% elif p.item.category == 'legal' %}gavel{% elif p.item.category == 'health' %}health_and_safety{% else %}check_circle{% endif %}</span>
            </div>
            <div class="flex-1">
                <h4 class="font-bold">{{ p.item.title }}</h4>
                <p class="text-xs text-slate-500 dark:text-slate-400">{{ p.item.description }}</p>
            </div>
            <div class="w-8 h-8 rounded-full bg-primary flex items-center justify-center">
                <span class="material-icons-round text-white text-xl">check</span>
            </div>
        </button>
    </form>
    {% else %}
    <!-- Pending Item -->
    <form method="post" class="block">
        {% csrf_token %}
        <input type="hidden" name="item_id" value="{{ p.item.pk }}" />
        <button type="submit" class="w-full bg-white/60 dark:bg-zinc-900/40 p-5 rounded-[28px] ios-shadow flex items-center gap-4 border border-white dark:border-zinc-800 opacity-80 text-left">
            <div class="w-14 h-14 rounded-2xl bg-slate-100 dark:bg-zinc-800 flex items-center justify-center text-slate-400">
                <span class="material-icons-round text-3xl">{% if p.item.category == 'document' %}description{% elif p.item.category == 'training' %}school{% elif p.item.category == 'legal' %}gavel{% elif p.item.category == 'health' %}health_and_safety{% else %}radio_button_unchecked{% endif %}</span>
            </div>
            <div class="flex-1">
                <h4 class="font-bold text-slate-600 dark:text-slate-400">{{ p.item.title }}</h4>
                <p class="text-xs text-slate-400 dark:text-slate-500">{{ p.item.description }}</p>
            </div>
            <div class="w-8 h-8 rounded-full border-2 border-slate-200 dark:border-zinc-700"></div>
        </button>
    </form>
    {% endif %}
    {% empty %}
    <div class="text-center py-4">
        <p class="text-sm text-slate-400">No checklist items yet. Check back soon!</p>
    </div>
    {% endfor %}
</div>
{% endblock %}
