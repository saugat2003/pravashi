{% extends 'base.html' %}

{% block title %}Pradesh Setu - Detailed AI Clause Analysis{% endblock %}

{% block extra_head %}
<style>
    .custom-scrollbar::-webkit-scrollbar { width: 4px; }
    .custom-scrollbar::-webkit-scrollbar-track { background: rgba(124, 179, 66, 0.05); }
    .custom-scrollbar::-webkit-scrollbar-thumb { background: rgba(124, 179, 66, 0.3); border-radius: 10px; }
    .custom-scrollbar::-webkit-scrollbar-thumb:hover { background: rgba(124, 179, 66, 0.5); }
</style>
{% endblock %}

{% block main_class %}p-0{% endblock %}

{% block header %}
<header class="flex-none pt-4 pb-4 px-4 border-b border-primary/10 z-20">
    <div class="flex items-center justify-between mb-4">
        <button onclick="history.back()" class="p-2 -ml-2 rounded-full hover:bg-primary/10 transition-colors text-gray-600 dark:text-gray-300">
            <span class="material-icons-round text-2xl">arrow_back</span>
        </button>
        <h1 class="text-lg font-semibold text-center flex-1">Contract Analysis</h1>
        <button class="p-2 -mr-2 rounded-full hover:bg-primary/10 transition-colors text-primary">
            <span class="material-icons-round text-2xl">share</span>
        </button>
    </div>
    <!-- Document Info -->
    <div class="flex items-center justify-between bg-white dark:bg-zinc-800/50 p-3 rounded-xl border border-primary/20 shadow-sm backdrop-blur-sm">
        <div class="flex items-center gap-3 overflow-hidden">
            <div class="h-10 w-10 bg-primary/10 rounded-lg flex items-center justify-center flex-shrink-0 text-primary">
                <span class="material-icons-round">description</span>
            </div>
            <div class="min-w-0">
                <p class="text-sm font-medium truncate">{{ analysis.employer_name|default:'Contract' }}</p>
                <p class="text-xs text-gray-500 dark:text-gray-400">Scanned {{ analysis.analyzed_at|date:'d M Y' }} &bull; {{ analysis.analyzed_at|time:'h:i A' }}</p>
            </div>
        </div>
        <div class="flex-shrink-0 flex items-center gap-1 {% if analysis.risk_level == 'high' %}bg-danger/10 text-danger border-danger/20{% elif analysis.risk_level == 'low' %}bg-success/10 text-success border-success/20{% else %}bg-warning/10 text-warning border-warning/20{% endif %} px-2 py-1 rounded-lg border">
            <span class="material-icons-round text-sm">{% if analysis.risk_level == 'high' %}warning{% elif analysis.risk_level == 'low' %}check_circle{% else %}info{% endif %}</span>
            <span class="text-xs font-bold uppercase tracking-wide">{{ analysis.get_risk_level_display }} Risk</span>
        </div>
    </div>
</header>
{% endblock %}

{% block content %}
<!-- Document Viewer -->
<div class="overflow-y-auto custom-scrollbar px-5 py-6 bg-white dark:bg-zinc-900">
    <div class="max-w-prose mx-auto">
        <p class="text-xs font-bold text-gray-400 mb-2 uppercase tracking-widest">Document Text</p>
        <div class="space-y-4 text-sm leading-relaxed text-gray-600 dark:text-gray-300 font-mono">
            <p>1. <span class="font-bold">EMPLOYMENT TERM:</span> The Employee agrees to work for a period of 2 years starting from the date of arrival.</p>
            <p>2. <span class="font-bold">SALARY:</span> The basic monthly salary shall be 1200 QAR.</p>
            <p>3. <span class="font-bold">ACCOMMODATION:</span> Provided by employer.</p>
            <p class="relative">
                4. <span class="font-bold">WORKING HOURS:</span> The employee shall work 8 hours per day, 6 days a week.
                <span class="bg-yellow-500/20 text-yellow-700 dark:text-yellow-200 underline decoration-wavy decoration-1 cursor-pointer">Any additional hours will be compensated at the discretion of the employer.</span>
                <span class="absolute -right-3 top-0 h-2 w-2 rounded-full bg-yellow-500 animate-pulse"></span>
            </p>
            <p>5. <span class="font-bold">LEAVE:</span> 21 days annual leave after completion of 12 months service.</p>
            <p>6. <span class="font-bold">TERMINATION:</span> Either party may terminate with 30 days notice.</p>
            <div class="relative p-1 -mx-1 rounded bg-danger/10 border-l-2 border-danger">
                <p class="text-gray-900 dark:text-white font-medium">
                    7. <span class="font-bold">DOCUMENTS:</span> The employee agrees to surrender their passport to the employer upon arrival for safekeeping purposes for the duration of the contract.
                </p>
                <span class="absolute -right-2 top-0 h-3 w-3 rounded-full bg-danger animate-ping opacity-75"></span>
                <span class="absolute -right-2 top-0 h-3 w-3 rounded-full bg-danger"></span>
            </div>
            <p>8. <span class="font-bold">MEDICAL:</span> Basic medical insurance provided.</p>
            <p>9. <span class="font-bold">TRANSPORT:</span> Provided from accommodation to work site.</p>
            <p>10. <span class="font-bold">DISPUTES:</span> All disputes settled under local jurisdiction.</p>
        </div>
    </div>
</div>

<!-- AI Findings -->
<div class="bg-background-light dark:bg-zinc-800 border-t border-primary/10 shadow-[0_-4px_20px_rgba(0,0,0,0.1)] z-10 rounded-t-2xl -mt-4">
    <div class="w-full flex justify-center pt-3 pb-1">
        <div class="w-12 h-1.5 rounded-full bg-gray-300 dark:bg-gray-600"></div>
    </div>
    <div class="px-5 pb-6 pt-2">
        <div class="flex justify-between items-end mb-4">
            <h2 class="text-lg font-bold">AI Findings</h2>
            <span class="text-xs bg-gray-200 dark:bg-white/10 px-2 py-1 rounded text-gray-600 dark:text-gray-400">{{ clauses|length }} Issue{{ clauses|length|pluralize }} Found</span>
        </div>
        <div class="space-y-4">
            {% for clause in clauses %}
            <div class="bg-white dark:bg-zinc-900 rounded-xl p-4 border {% if clause.severity == 'illegal' %}border-danger/30{% elif clause.severity == 'high_risk' %}border-yellow-500/20{% else %}border-slate-200{% endif %} shadow-sm">
                <div class="flex gap-4">
                    <div class="flex-shrink-0 mt-1">
                        <div class="w-10 h-10 rounded-full {% if clause.severity == 'illegal' %}bg-danger/10 text-danger border-danger/20{% elif clause.severity == 'high_risk' %}bg-yellow-500/10 text-yellow-600 dark:text-yellow-500 border-yellow-500/20{% else %}bg-amber-100 text-amber-600 border-amber-200{% endif %} flex items-center justify-center border">
                            <span class="material-icons-round">{% if clause.severity == 'illegal' %}gpp_bad{% else %}priority_high{% endif %}</span>
                        </div>
                    </div>
                    <div class="flex-1">
                        <div class="flex justify-between items-start">
                            <h3 class="font-bold {% if clause.severity == 'illegal' %}text-danger{% elif clause.severity == 'high_risk' %}text-yellow-700 dark:text-yellow-500{% else %}text-amber-700{% endif %} text-base">{{ clause.title }}</h3>
                            <span class="text-[10px] font-bold uppercase tracking-wider text-white {% if clause.severity == 'illegal' %}bg-danger{% elif clause.severity == 'high_risk' %}bg-yellow-500{% else %}bg-amber-500{% endif %} px-1.5 py-0.5 rounded">{{ clause.get_severity_display }}</span>
                        </div>
                        <p class="text-sm text-gray-600 dark:text-gray-400 leading-snug mt-2">{{ clause.explanation_ne }}</p>
                        {% if clause.original_text %}
                        <p class="text-sm text-gray-500 mt-2 italic">"{{ clause.original_text|truncatewords:20 }}"</p>
                        {% endif %}
                    </div>
                </div>
            </div>
            {% empty %}
            <div class="text-center py-4">
                <span class="material-symbols-rounded text-success text-3xl">verified</span>
                <p class="text-sm text-gray-500 mt-1">No issues found in this contract.</p>
            </div>
            {% endfor %}
        </div>

        <!-- AI Recommendation -->
        {% if analysis.ai_recommendation %}
        <div class="mt-6 {% if analysis.risk_level == 'high' %}bg-danger{% elif analysis.risk_level == 'low' %}bg-success{% else %}bg-warning{% endif %} text-white rounded-xl shadow-lg p-4">
            <div class="flex items-start gap-3">
                <span class="material-icons-round text-white/90 bg-white/20 rounded-full p-1 text-lg">verified_user</span>
                <div>
                    <h3 class="font-bold text-sm uppercase tracking-wide opacity-90">AI Recommendation</h3>
                    <p class="font-medium text-lg leading-tight mt-0.5">{{ analysis.ai_recommendation }}</p>
                </div>
            </div>
            <div class="grid grid-cols-2 gap-3 mt-4">
                <a href="{% url 'main:embassy_contact_directory' %}" class="flex items-center justify-center gap-2 bg-white {% if analysis.risk_level == 'high' %}text-danger{% elif analysis.risk_level == 'low' %}text-success{% else %}text-warning{% endif %} font-bold py-3 px-4 rounded-lg">
                    <span class="material-icons-round text-lg">call</span> Call Embassy
                </a>
                <a href="{% url 'main:contract_analysis_upload' %}" class="flex items-center justify-center gap-2 bg-black/20 text-white font-semibold py-3 px-4 rounded-lg border border-white/10">
                    <span class="material-icons-round text-lg">upload_file</span> New Analysis
                </a>
            </div>
        </div>
        {% endif %}
    </div>
</div>
{% endblock %}

{% block bottom_nav %}{% endblock %}
