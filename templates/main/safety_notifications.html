{% extends 'base.html' %}

{% block title %}Notifications - Pravash{% endblock %}

{% block extra_head %}
<style>
    .tab-active {
        background: #7CB342;
        color: #fff;
    }
</style>
{% endblock %}

{% block header %}
<header class="sticky top-0 z-20 bg-background-light/80 dark:bg-background-dark/80 backdrop-blur-xl border-b border-slate-100 dark:border-slate-800 px-6 py-3">
    <div class="flex items-center justify-between">
        <div class="flex items-center gap-3">
            <button onclick="history.back()" class="w-9 h-9 rounded-full bg-white dark:bg-zinc-800 flex items-center justify-center ios-shadow">
                <span class="material-icons-round text-slate-700 dark:text-slate-300">chevron_left</span>
            </button>
            <h1 class="text-lg font-bold tracking-tight">Notifications</h1>
        </div>
        <form method="post" action="?mark_all_read=1" class="inline">
            {% csrf_token %}
            <button type="submit" class="text-xs text-primary font-semibold">Mark all read</button>
        </form>
    </div>
    <!-- Filter Tabs -->
    <div class="flex gap-2 mt-3 overflow-x-auto no-scrollbar">
        <a href="{% url 'main:safety_notifications' %}" class="{% if not request.GET.category %}tab-active{% else %}bg-white dark:bg-zinc-800 border border-slate-200 dark:border-zinc-700 text-slate-600 dark:text-slate-300{% endif %} px-4 py-2 rounded-full text-xs font-bold whitespace-nowrap transition-all">All</a>
        <a href="{% url 'main:safety_notifications' %}?category=safety" class="{% if request.GET.category == 'safety' %}tab-active{% else %}bg-white dark:bg-zinc-800 border border-slate-200 dark:border-zinc-700 text-slate-600 dark:text-slate-300{% endif %} px-4 py-2 rounded-full text-xs font-bold whitespace-nowrap transition-all">Safety</a>
        {# Check-ins tab removed per request #}
        <a href="{% url 'main:safety_notifications' %}?category=community" class="{% if request.GET.category == 'community' %}tab-active{% else %}bg-white dark:bg-zinc-800 border border-slate-200 dark:border-zinc-700 text-slate-600 dark:text-slate-300{% endif %} px-4 py-2 rounded-full text-xs font-bold whitespace-nowrap transition-all">Community</a>
    </div>
</header>
{% endblock %}

{% block content %}
<!-- Notifications -->
<section>
    {% if today_notifications %}
    <h2 class="text-xs font-bold text-slate-400 uppercase tracking-widest mb-3">Today</h2>
    <div class="space-y-3">
        {% for n in today_notifications %}
        <div class="{% if not n.is_read %}{% if n.category == 'safety' or n.category == 'sos' %}bg-danger/5 dark:bg-danger/10 border-danger/20{% else %}bg-white dark:bg-zinc-900 border-slate-100 dark:border-zinc-800{% endif %}{% else %}bg-white dark:bg-zinc-900 border-slate-100 dark:border-zinc-800 opacity-70{% endif %} p-4 rounded-2xl border flex items-start gap-3">
            <div class="w-10 h-10 rounded-xl {% if n.category == 'safety' or n.category == 'sos' %}bg-danger/20 text-danger{% elif n.category == 'community' %}bg-info/10 dark:bg-info/20 text-info{% elif n.category == 'contract' %}bg-success/10 text-success{% elif n.category == 'document' %}bg-warning/10 text-warning{% else %}bg-slate-100 text-slate-500{% endif %} flex items-center justify-center shrink-0">
                <span class="material-icons-round text-xl">{% if n.category == 'safety' or n.category == 'sos' %}warning{% elif n.category == 'community' %}groups{% elif n.category == 'contract' %}verified{% elif n.category == 'document' %}folder{% else %}notifications{% endif %}</span>
            </div>
            <div class="flex-1">
                <div class="flex items-center justify-between">
                    <span class="text-xs font-bold {% if n.category == 'safety' or n.category == 'sos' %}text-danger{% elif n.category == 'community' %}text-info{% elif n.category == 'contract' %}text-success{% elif n.category == 'document' %}text-warning{% else %}text-slate-500{% endif %}">{{ n.get_category_display }}</span>
                    <span class="text-[10px] text-slate-400">{{ n.created_at|timesince }} ago</span>
                </div>
                <p class="text-sm font-semibold mt-1">{{ n.title }}</p>
                <p class="text-xs text-slate-500 dark:text-slate-400 mt-0.5">{{ n.description }}</p>
                {% if not n.is_read %}
                <form method="post" class="inline mt-2">
                    {% csrf_token %}
                    <input type="hidden" name="mark_read" value="{{ n.pk }}" />
                    <button type="submit" class="text-xs font-bold text-primary">Mark as read</button>
                </form>
                {% endif %}
            </div>
        </div>
        {% endfor %}
    </div>
    {% endif %}
</section>

<!-- Earlier -->
{% if earlier_notifications %}
<section class="mt-6 mb-6">
    <h2 class="text-xs font-bold text-slate-400 uppercase tracking-widest mb-3">Earlier</h2>
    <div class="space-y-3">
        {% for n in earlier_notifications %}
        <div class="bg-white dark:bg-zinc-900 p-4 rounded-2xl border border-slate-100 dark:border-zinc-800 flex items-start gap-3 opacity-70">
            <div class="w-10 h-10 rounded-xl {% if n.category == 'safety' or n.category == 'sos' %}bg-danger/20 text-danger{% elif n.category == 'community' %}bg-info/10 text-info{% elif n.category == 'contract' %}bg-success/10 text-success{% elif n.category == 'document' %}bg-warning/10 text-warning{% else %}bg-slate-100 text-slate-500{% endif %} flex items-center justify-center shrink-0">
                <span class="material-icons-round text-xl">{% if n.category == 'safety' or n.category == 'sos' %}warning{% elif n.category == 'community' %}groups{% elif n.category == 'contract' %}verified{% elif n.category == 'document' %}folder{% else %}notifications{% endif %}</span>
            </div>
            <div class="flex-1">
                <div class="flex items-center justify-between">
                    <span class="text-xs font-bold {% if n.category == 'safety' %}text-danger{% elif n.category == 'contract' %}text-success{% elif n.category == 'document' %}text-warning{% else %}text-slate-500{% endif %}">{{ n.get_category_display }}</span>
                    <span class="text-[10px] text-slate-400">{{ n.created_at|timesince }} ago</span>
                </div>
                <p class="text-sm font-semibold mt-1">{{ n.title }}</p>
                <p class="text-xs text-slate-500 dark:text-slate-400 mt-0.5">{{ n.description }}</p>
            </div>
        </div>
        {% endfor %}
    </div>
</section>
{% endif %}

{% if not today_notifications and not earlier_notifications %}
<div class="text-center py-12">
    <span class="material-icons-round text-slate-300 text-5xl">notifications_off</span>
    <p class="text-sm text-slate-400 mt-3">No notifications yet. You're all caught up!</p>
</div>
{% endif %}
{% endblock %}
